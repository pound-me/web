import{d as I,t as A,c as R,r as C,a7 as G,Y,a as t,w as F,l as L,a8 as j,a9 as J,x,o as Q,aa as W,e as X,ab as Z,s as ee,q as ne,O as te,V as oe,ac as ae,m as le,M as se,n as re,ad as $,ae as ie,af as ce,ag as ue,ah as de,ai as fe,z as me,A as ge,D as h,a6 as T,H as D,J as K,aj as V,K as ve}from"./index-BqY3WvCA.js";import{B as U,C as Be,F as we}from"./index-X6xwfEeo.js";import{C as he,s as b}from"./index-DTvcFppj.js";import{u as be}from"./user-BR_IM7jV.js";import{b as N}from"./route-block-B_A1xBdJ.js";const[z,H]=R("action-bar"),M=Symbol(z),Ce={placeholder:Boolean,safeAreaInsetBottom:A};var ye=I({name:z,props:Ce,setup(e,{slots:u}){const o=C(),r=G(o,H),{linkChildren:i}=Y(M);i();const f=()=>{var d;return t("div",{ref:o,class:[H(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(d=u.default)==null?void 0:d.call(u)])};return()=>e.placeholder?r(f):f()}});const pe=F(ye),[ke,Pe]=R("action-bar-button"),xe=L({},W,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var _e=I({name:ke,props:xe,setup(e,{slots:u}){const o=j(),{parent:r,index:i}=J(M),f=x(()=>{if(r){const a=r.children[i.value-1];return!(a&&"isButton"in a)}}),d=x(()=>{if(r){const a=r.children[i.value+1];return!(a&&"isButton"in a)}});return Q({isButton:!0}),()=>{const{type:a,icon:m,text:B,color:y,loading:p,disabled:k}=e;return t(U,{class:Pe([a,{last:d.value,first:f.value}]),size:"large",type:a,icon:m,color:y,loading:p,disabled:k,onClick:o},{default:()=>[u.default?u.default():B]})}}});const q=F(_e),[Se,v,E]=R("dialog"),Te=L({},ae,{title:String,theme:String,width:re,message:[String,Function],callback:Function,allowHtml:Boolean,className:se,transition:le("van-dialog-bounce"),messageAlign:String,closeOnPopstate:A,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:A,closeOnClickOverlay:Boolean,keyboardEnabled:A,destroyOnClose:Boolean}),De=[...ce,"transition","closeOnPopstate","destroyOnClose"];var Ve=I({name:Se,props:Te,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:u,slots:o}){const r=C(),i=X({confirm:!1,cancel:!1}),f=n=>u("update:show",n),d=n=>{var s;f(!1),(s=e.callback)==null||s.call(e,n)},a=n=>()=>{e.show&&(u(n),e.beforeClose?(i[n]=!0,ie(e.beforeClose,{args:[n],done(){d(n),i[n]=!1},canceled(){i[n]=!1}})):d(n))},m=a("cancel"),B=a("confirm"),y=Z(n=>{var s,l;if(!e.keyboardEnabled||n.target!==((l=(s=r.value)==null?void 0:s.popupRef)==null?void 0:l.value))return;({Enter:e.showConfirmButton?B:$,Escape:e.showCancelButton?m:$})[n.key](),u("keydown",n)},["enter","esc"]),p=()=>{const n=o.title?o.title():e.title;if(n)return t("div",{class:v("header",{isolated:!e.message&&!o.default})},[n])},k=n=>{const{message:s,allowHtml:l,messageAlign:w}=e,S=v("message",{"has-title":n,[w]:w}),O=ue(s)?s():s;return l&&typeof O=="string"?t("div",{class:S,innerHTML:O},null):t("div",{class:S},[O])},g=()=>{if(o.default)return t("div",{class:v("content")},[o.default()]);const{title:n,message:s,allowHtml:l}=e;if(s){const w=!!(n||o.title);return t("div",{key:l?1:0,class:v("content",{isolated:!w})},[k(w)])}},c=()=>t("div",{class:[fe,v("footer")]},[e.showCancelButton&&t(U,{size:"large",text:e.cancelButtonText||E("cancel"),class:v("cancel"),style:{color:e.cancelButtonColor},loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:m},null),e.showConfirmButton&&t(U,{size:"large",text:e.confirmButtonText||E("confirm"),class:[v("confirm"),{[de]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:B},null)]),P=()=>t(pe,{class:v("footer")},{default:()=>[e.showCancelButton&&t(q,{type:"warning",text:e.cancelButtonText||E("cancel"),class:v("cancel"),color:e.cancelButtonColor,loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:m},null),e.showConfirmButton&&t(q,{type:"danger",text:e.confirmButtonText||E("confirm"),class:v("confirm"),color:e.confirmButtonColor,loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:B},null)]}),_=()=>o.footer?o.footer():e.theme==="round-button"?P():c();return()=>{const{width:n,title:s,theme:l,message:w,className:S}=e;return t(oe,ee({ref:r,role:"dialog",class:[v([l]),S],style:{width:te(n)},tabindex:0,"aria-labelledby":s||w,onKeydown:y,"onUpdate:show":f},ne(e,De)),{default:()=>[p(),g(),_()]})}}});const Ee=F(Ve),Ae=I({__name:"index",setup(e){const u=be(),o=x(()=>u.userInfo),r=x(()=>!!o.value.name),i=x(()=>"生活不止眼前的苟且，还有诗和远方的田野"),f=C(!1),d=C(""),a=C(""),m=C("");function B(){r.value||V.push({name:"login",query:{redirect:"profile"}})}function y(){if(!r.value){B();return}d.value="",a.value=o.value.name||"",m.value="",f.value=!0}async function p(){if(!d.value||!a.value||!m.value){b("请填写完整信息");return}try{const g=await ve.post("/change-user-info",{oldPassword:d.value,newUsername:a.value,newPassword:m.value});u.userInfo.name=g.username,b(g.message||"用户信息修改成功"),f.value=!1,g.needRelogin&&(b("用户信息已修改，请重新登录"),V.push({name:"login",query:{redirect:V.currentRoute.value.fullPath}}))}catch(g){b("请求失败，请稍后再试"),console.error(g)}}async function k(){try{await u.logout(),b("注销成功"),V.push({name:"login"})}catch(g){b("注销失败，请稍后再试"),console.error(g)}}return(g,c)=>{const P=Be,_=he,n=we,s=Ee;return ge(),me("div",null,[t(_,{inset:!0},{default:h(()=>[t(P,{center:"","is-link":!T(r),onClick:B},{title:h(()=>[D("span",null,K(T(r)?"".concat(T(o).name):g.$t("profile.login")),1)]),label:h(()=>[D("span",null,K(T(i)),1)]),_:1},8,["is-link"])]),_:1}),t(_,{inset:!0,class:"!mt-16"},{default:h(()=>[t(P,{title:"修改用户信息",icon:"setting-o","is-link":"",onClick:y},{icon:h(()=>c[4]||(c[4]=[D("div",{class:"i-carbon:settings text-gray-400 mr-5 self-center"},null,-1)])),_:1}),t(P,{title:"注销登录","is-link":"",onClick:k},{icon:h(()=>c[5]||(c[5]=[D("div",{class:"i-carbon:logout text-gray-400 mr-5 self-center"},null,-1)])),_:1})]),_:1}),t(s,{show:f.value,"onUpdate:show":c[3]||(c[3]=l=>f.value=l),title:"修改用户信息","show-cancel-button":"",onConfirm:p},{default:h(()=>[t(n,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=l=>a.value=l),label:"用户名",placeholder:"请输入新用户名"},null,8,["modelValue"]),t(n,{modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=l=>d.value=l),label:"旧密码",placeholder:"请输入旧密码",type:"password"},null,8,["modelValue"]),t(n,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=l=>m.value=l),label:"新密码",placeholder:"请输入新密码",type:"password"},null,8,["modelValue"])]),_:1},8,["show"])])}}});typeof N=="function"&&N(Ae);export{Ae as default};
