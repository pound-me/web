import{d as me,M as oe,n as _e,c as $e,N as ye,a as d,O as ge,w as we,P as be,Q as Se,r as C,y as Me,K as re,z as ee,A,H as h,D as b,E as I,J as Q,C as le,F as ce,G as ke,R as De,S as Ce,L as Ve,T as de,U as Oe,V as xe,_ as Ne}from"./index-BqY3WvCA.js";import{L as he,C as Te,B as Ye,F as je}from"./index-X6xwfEeo.js";import{s as M,C as Ue}from"./index-DTvcFppj.js";import{T as ze}from"./index-BulNcSWP.js";import{b as fe}from"./route-block-B_A1xBdJ.js";const[Fe,ue]=$e("switch"),He={size:_e,loading:Boolean,disabled:Boolean,modelValue:oe,activeColor:String,inactiveColor:String,activeValue:{type:oe,default:!0},inactiveValue:{type:oe,default:!1}};var Le=me({name:Fe,props:He,emits:["change","update:modelValue"],setup(k,{emit:E,slots:p}){const _=()=>k.modelValue===k.activeValue,U=()=>{if(!k.disabled&&!k.loading){const v=_()?k.inactiveValue:k.activeValue;E("update:modelValue",v),E("change",v)}},Y=()=>{if(k.loading){const v=_()?k.activeColor:k.inactiveColor;return d(he,{class:ue("loading"),color:v},null)}if(p.node)return p.node()};return ye(()=>k.modelValue),()=>{var v;const{size:w,loading:V,disabled:m,activeColor:O,inactiveColor:$}=k,x=_(),S={fontSize:ge(w),backgroundColor:x?O:$};return d("div",{role:"switch",class:ue({on:x,loading:V,disabled:m}),style:S,tabindex:m?void 0:0,"aria-checked":x,onClick:U},[d("div",{class:ue("node")},[Y()]),(v=p.background)==null?void 0:v.call(p)])}}});const Je=we(Le);var te={exports:{}},Ae=te.exports,ve;function Ie(){return ve||(ve=1,function(k,E){(function(p,_){k.exports=_()})(Ae,function(){var p=1e3,_=6e4,U=36e5,Y="millisecond",v="second",w="minute",V="hour",m="day",O="week",$="month",x="quarter",S="year",N="date",z="Invalid Date",ne=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,se=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ae={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(o){var a=["th","st","nd","rd"],t=o%100;return"["+o+(a[(t-20)%10]||a[t]||a[0])+"]"}},P=function(o,a,t){var i=String(o);return!i||i.length>=a?o:""+Array(a+1-i.length).join(t)+o},ie={s:P,z:function(o){var a=-o.utcOffset(),t=Math.abs(a),i=Math.floor(t/60),s=t%60;return(a<=0?"+":"-")+P(i,2,"0")+":"+P(s,2,"0")},m:function o(a,t){if(a.date()<t.date())return-o(t,a);var i=12*(t.year()-a.year())+(t.month()-a.month()),s=a.clone().add(i,$),r=t-s<0,n=a.clone().add(i+(r?-1:1),$);return+(-(i+(t-s)/(r?s-n:n-s))||0)},a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:$,y:S,w:O,d:m,D:N,h:V,m:w,s:v,ms:Y,Q:x}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},H="en",j={};j[H]=ae;var q="$isDayjsObject",R=function(o){return o instanceof W||!(!o||!o[q])},u=function o(a,t,i){var s;if(!a)return H;if(typeof a=="string"){var r=a.toLowerCase();j[r]&&(s=r),t&&(j[r]=t,s=r);var n=a.split("-");if(!s&&n.length>1)return o(n[0])}else{var c=a.name;j[c]=a,s=c}return!i&&s&&(H=s),s||!i&&H},e=function(o,a){if(R(o))return o.clone();var t=typeof a=="object"?a:{};return t.date=o,t.args=arguments,new W(t)},l=ie;l.l=u,l.i=R,l.w=function(o,a){return e(o,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var W=function(){function o(t){this.$L=u(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[q]=!0}var a=o.prototype;return a.parse=function(t){this.$d=function(i){var s=i.date,r=i.utc;if(s===null)return new Date(NaN);if(l.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var n=s.match(ne);if(n){var c=n[2]-1||0,f=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],c,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)):new Date(n[1],c,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)}}return new Date(s)}(t),this.init()},a.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},a.$utils=function(){return l},a.isValid=function(){return this.$d.toString()!==z},a.isSame=function(t,i){var s=e(t);return this.startOf(i)<=s&&s<=this.endOf(i)},a.isAfter=function(t,i){return e(t)<this.startOf(i)},a.isBefore=function(t,i){return this.endOf(i)<e(t)},a.$g=function(t,i,s){return l.u(t)?this[i]:this.set(s,t)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(t,i){var s=this,r=!!l.u(i)||i,n=l.p(t),c=function(J,D){var F=l.w(s.$u?Date.UTC(s.$y,D,J):new Date(s.$y,D,J),s);return r?F:F.endOf(m)},f=function(J,D){return l.w(s.toDate()[J].apply(s.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(D)),s)},y=this.$W,g=this.$M,T=this.$D,B="set"+(this.$u?"UTC":"");switch(n){case S:return r?c(1,0):c(31,11);case $:return r?c(1,g):c(0,g+1);case O:var L=this.$locale().weekStart||0,G=(y<L?y+7:y)-L;return c(r?T-G:T+(6-G),g);case m:case N:return f(B+"Hours",0);case V:return f(B+"Minutes",1);case w:return f(B+"Seconds",2);case v:return f(B+"Milliseconds",3);default:return this.clone()}},a.endOf=function(t){return this.startOf(t,!1)},a.$set=function(t,i){var s,r=l.p(t),n="set"+(this.$u?"UTC":""),c=(s={},s[m]=n+"Date",s[N]=n+"Date",s[$]=n+"Month",s[S]=n+"FullYear",s[V]=n+"Hours",s[w]=n+"Minutes",s[v]=n+"Seconds",s[Y]=n+"Milliseconds",s)[r],f=r===m?this.$D+(i-this.$W):i;if(r===$||r===S){var y=this.clone().set(N,1);y.$d[c](f),y.init(),this.$d=y.set(N,Math.min(this.$D,y.daysInMonth())).$d}else c&&this.$d[c](f);return this.init(),this},a.set=function(t,i){return this.clone().$set(t,i)},a.get=function(t){return this[l.p(t)]()},a.add=function(t,i){var s,r=this;t=Number(t);var n=l.p(i),c=function(g){var T=e(r);return l.w(T.date(T.date()+Math.round(g*t)),r)};if(n===$)return this.set($,this.$M+t);if(n===S)return this.set(S,this.$y+t);if(n===m)return c(1);if(n===O)return c(7);var f=(s={},s[w]=_,s[V]=U,s[v]=p,s)[n]||1,y=this.$d.getTime()+t*f;return l.w(y,this)},a.subtract=function(t,i){return this.add(-1*t,i)},a.format=function(t){var i=this,s=this.$locale();if(!this.isValid())return s.invalidDate||z;var r=t||"YYYY-MM-DDTHH:mm:ssZ",n=l.z(this),c=this.$H,f=this.$m,y=this.$M,g=s.weekdays,T=s.months,B=s.meridiem,L=function(D,F,K,X){return D&&(D[F]||D(i,r))||K[F].slice(0,X)},G=function(D){return l.s(c%12||12,D,"0")},J=B||function(D,F,K){var X=D<12?"AM":"PM";return K?X.toLowerCase():X};return r.replace(se,function(D,F){return F||function(K){switch(K){case"YY":return String(i.$y).slice(-2);case"YYYY":return l.s(i.$y,4,"0");case"M":return y+1;case"MM":return l.s(y+1,2,"0");case"MMM":return L(s.monthsShort,y,T,3);case"MMMM":return L(T,y);case"D":return i.$D;case"DD":return l.s(i.$D,2,"0");case"d":return String(i.$W);case"dd":return L(s.weekdaysMin,i.$W,g,2);case"ddd":return L(s.weekdaysShort,i.$W,g,3);case"dddd":return g[i.$W];case"H":return String(c);case"HH":return l.s(c,2,"0");case"h":return G(1);case"hh":return G(2);case"a":return J(c,f,!0);case"A":return J(c,f,!1);case"m":return String(f);case"mm":return l.s(f,2,"0");case"s":return String(i.$s);case"ss":return l.s(i.$s,2,"0");case"SSS":return l.s(i.$ms,3,"0");case"Z":return n}return null}(D)||n.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(t,i,s){var r,n=this,c=l.p(i),f=e(t),y=(f.utcOffset()-this.utcOffset())*_,g=this-f,T=function(){return l.m(n,f)};switch(c){case S:r=T()/12;break;case $:r=T();break;case x:r=T()/3;break;case O:r=(g-y)/6048e5;break;case m:r=(g-y)/864e5;break;case V:r=g/U;break;case w:r=g/_;break;case v:r=g/p;break;default:r=g}return s?r:l.a(r)},a.daysInMonth=function(){return this.endOf($).$D},a.$locale=function(){return j[this.$L]},a.locale=function(t,i){if(!t)return this.$L;var s=this.clone(),r=u(t,i,!0);return r&&(s.$L=r),s},a.clone=function(){return l.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},o}(),Z=W.prototype;return e.prototype=Z,[["$ms",Y],["$s",v],["$m",w],["$H",V],["$W",m],["$M",$],["$y",S],["$D",N]].forEach(function(o){Z[o[1]]=function(a){return this.$g(a,o[0],o[1])}}),e.extend=function(o,a){return o.$i||(o(a,W,e),o.$i=!0),e},e.locale=u,e.isDayjs=R,e.unix=function(o){return e(1e3*o)},e.en=j[H],e.Ls=j,e.p={},e})}(te)),te.exports}var We=Ie();const Be=be(We),Ee={class:"control-page"},Pe={class:"cell-content"},qe={class:"cell-left"},Re={class:"cell-title"},Ze={class:"cell-label"},Ge={class:"icon-group"},Ke={class:"edit-popup"},Qe={class:"edit-header"},Xe={class:"edit-content"},et={key:0,class:"boolean-edit"},tt={class:"edit-label"},nt={class:"edit-label"},st={class:"edit-footer"},at={class:"edit-popup"},it={class:"edit-header"},ot={class:"edit-footer"},rt={class:"edit-popup"},lt={class:"edit-header"},ut={class:"edit-footer"},pe=me({__name:"index",setup(k){const E=Se(),p=C(),_=C(),U=C(!1),Y=C(!1),v=C(""),w=C(""),V=C({}),m=C({}),O=C(!1),$=C(""),x=C(""),S=C(!1),N=C(""),z=C("");function ne(u,e){v.value=u,typeof e=="boolean"||typeof e=="number"?w.value=e:w.value=JSON.stringify(e,null,2),Y.value=!0}function se(){let u=w.value;const e=V.value[v.value];if(typeof e=="number"){const l=Number(u);if(Number.isNaN(l)){M("请输入有效的数字");return}u=l}else if(typeof e=="boolean")u=!!u;else if(typeof e=="object")try{u=JSON.parse(u)}catch(l){M("请输入有效的JSON格式");return}JSON.stringify(u)===JSON.stringify(e)?delete m.value[v.value]:m.value[v.value]=u,_.value&&(_.value[v.value]=u),Y.value=!1}function ae(){$.value="",x.value="",O.value=!0}function P(){if(!$.value){M("请输入字段名");return}if($.value.startsWith("_")){M("字段名不能以下划线开头");return}if($.value in _.value){M("字段名已存在");return}m.value[$.value]=x.value,_.value&&(_.value[$.value]=x.value),O.value=!1}async function ie(){var u;if(!(!((u=p.value)!=null&&u.imei)||Object.keys(m.value).length===0))try{(await re.post("/executeTask",{imei:p.value.imei,task:"set_config",configs:m.value})).success?(M("保存成功"),m.value={},q()):M("保存失败")}catch(e){M("保存失败"),console.error("保存失败:",e)}}function H(u){u in m.value?delete m.value[u]:_.value&&u in _.value&&(m.value[u]=null),_.value&&delete _.value[u]}async function j(){var u;if((u=p.value)!=null&&u.imei){if(!N.value){M("请输入收件人");return}if(!z.value){M("请输入短信内容");return}try{(await re.post("/executeTask",{imei:p.value.imei,task:"send_sms",rcv_phone:N.value,content:z.value})).success?(M("发送成功"),S.value=!1,N.value="",z.value=""):M("发送失败")}catch(e){M("发送失败"),console.error("发送失败:",e)}}}Me(()=>{const u=E.query.device;u&&(p.value=JSON.parse(u),q())});async function q(){var u;if((u=p.value)!=null&&u.imei){U.value=!0;try{const e=await re.post("/executeTask",{imei:p.value.imei,task:"get_config"});e.success?(_.value=e.result,V.value={...e.result}):M("获取配置失败")}catch(e){M("获取配置失败"),console.error("获取配置失败:",e)}finally{U.value=!1}}}function R(u){return Be(u).format("YYYY-MM-DD HH:mm:ss")}return(u,e)=>{const l=Te,W=ze,Z=Ue,o=he,a=Ve,t=Ye,i=Je,s=je,r=xe;return A(),ee("div",Ee,[d(Z,{inset:!0},{default:b(()=>{var n,c,f;return[d(l,{title:"IMEI",value:(n=p.value)==null?void 0:n.imei},null,8,["value"]),d(l,{title:"手机号",value:((c=p.value)==null?void 0:c.phone)||"未设置"},null,8,["value"]),d(l,{title:"在线状态"},{value:b(()=>{var y;return[d(W,{type:(y=p.value)!=null&&y.connected?"success":"danger",size:"medium"},{default:b(()=>{var g;return[I(Q((g=p.value)!=null&&g.connected?"在线":"离线"),1)]}),_:1},8,["type"])]}),_:1}),d(l,{title:"最后在线时间",value:(f=p.value)!=null&&f.lastSeen?R(p.value.lastSeen):"-"},null,8,["value"])]}),_:1}),d(Z,{inset:!0,title:"设备配置"},{default:b(()=>[U.value?(A(),le(l,{key:0,center:""},{title:b(()=>[d(o,{type:"spinner",size:"24px"},{default:b(()=>e[13]||(e[13]=[I(" 加载中... ")])),_:1,__:[13]})]),_:1})):_.value?(A(!0),ee(ce,{key:1},ke(_.value,(n,c)=>De((A(),le(l,{key:c,class:Ce({"changed-field":c in m.value})},{title:b(()=>[h("div",Pe,[h("div",qe,[h("div",Re,Q(c),1),h("div",Ze,Q(n==null||n===""?"未配置":typeof n=="object"?JSON.stringify(n):String(n)),1)]),h("div",Ge,[d(a,{name:"edit",class:"edit-icon",onClick:de(f=>ne(c,n),["stop"])},null,8,["onClick"]),d(a,{name:"delete",class:"delete-icon",onClick:de(f=>H(c),["stop"])},null,8,["onClick"])])])]),_:2},1032,["class"])),[[Oe,!c.startsWith("_")]])),128)):(A(),le(l,{key:2,title:"暂无配置信息"})),d(l,null,{title:b(()=>[d(t,{plain:"",block:"",type:"primary",onClick:ae},{default:b(()=>e[14]||(e[14]=[I(" 新增字段 ")])),_:1,__:[14]})]),_:1}),d(l,null,{title:b(()=>[d(t,{block:"",type:"primary",disabled:Object.keys(m.value).length===0,onClick:ie},{default:b(()=>e[15]||(e[15]=[I(" 保存所有配置 ")])),_:1,__:[15]},8,["disabled"])]),_:1})]),_:1}),d(r,{show:Y.value,"onUpdate:show":e[3]||(e[3]=n=>Y.value=n),position:"bottom",round:""},{default:b(()=>[h("div",Ke,[h("div",Qe,[e[16]||(e[16]=h("span",{class:"edit-title"},"编辑配置",-1)),d(a,{name:"cross",onClick:e[0]||(e[0]=n=>Y.value=!1)})]),h("div",Xe,[typeof w.value=="boolean"?(A(),ee("div",et,[h("span",tt,Q(v.value),1),d(i,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=n=>w.value=n),size:"24"},null,8,["modelValue"])])):(A(),ee(ce,{key:1},[h("div",nt,Q(v.value),1),d(s,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=n=>w.value=n),type:typeof V.value[v.value]=="number"?"number":"textarea",rows:"4",autosize:"",maxlength:"500","show-word-limit":"",placeholder:"请输入配置值"},null,8,["modelValue","type"])],64))]),h("div",st,[d(t,{block:"",type:"primary",onClick:se},{default:b(()=>e[17]||(e[17]=[I(" 确定 ")])),_:1,__:[17]})])])]),_:1},8,["show"]),d(r,{show:O.value,"onUpdate:show":e[7]||(e[7]=n=>O.value=n),position:"bottom",round:""},{default:b(()=>[h("div",at,[h("div",it,[e[18]||(e[18]=h("span",{class:"edit-title"},"新增字段",-1)),d(a,{name:"cross",onClick:e[4]||(e[4]=n=>O.value=!1)})]),h("div",null,[d(s,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=n=>$.value=n),label:"字段名",placeholder:"请输入字段名",rules:[{required:!0,message:"请输入字段名"}]},null,8,["modelValue"]),d(s,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=n=>x.value=n),label:"字段值",type:"textarea",rows:"4",autosize:"",placeholder:"请输入字段值"},null,8,["modelValue"])]),h("div",ot,[d(t,{block:"",type:"primary",onClick:P},{default:b(()=>e[19]||(e[19]=[I(" 确定 ")])),_:1,__:[19]})])])]),_:1},8,["show"]),d(r,{show:S.value,"onUpdate:show":e[11]||(e[11]=n=>S.value=n),position:"bottom",round:""},{default:b(()=>[h("div",rt,[h("div",lt,[e[20]||(e[20]=h("span",{class:"edit-title"},"发送短信",-1)),d(a,{name:"cross",onClick:e[8]||(e[8]=n=>S.value=!1)})]),h("div",null,[d(s,{modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=n=>N.value=n),label:"收件人",placeholder:"请输入收件人手机号，多个收件人用逗号分隔",rules:[{required:!0,message:"请输入收件人"}]},null,8,["modelValue"]),d(s,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=n=>z.value=n),label:"短信内容",type:"textarea",rows:"4",autosize:"",maxlength:"500","show-word-limit":"",placeholder:"请输入短信内容",rules:[{required:!0,message:"请输入短信内容"}]},null,8,["modelValue"])]),h("div",ut,[d(t,{block:"",type:"primary",onClick:j},{default:b(()=>e[21]||(e[21]=[I(" 发送 ")])),_:1,__:[21]})])])]),_:1},8,["show"]),h("div",{class:"sms-fab",onClick:e[12]||(e[12]=n=>S.value=!0)},[d(a,{name:"chat-o",size:"24"})])])}}});typeof fe=="function"&&fe(pe);const ht=Ne(pe,[["__scopeId","data-v-088d2eb3"]]);export{ht as default};
